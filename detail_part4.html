    // 返信フォームを表示
    function showReplyForm(commentId) {
      log('返信フォーム表示', commentId);
      
      // すべての返信フォームを非表示にする
      var allReplyForms = document.querySelectorAll('.reply-form');
      for (var i = 0; i < allReplyForms.length; i++) {
        allReplyForms[i].style.display = 'none';
      }
      
      // 該当するコメントの返信フォームを表示
      var comment = document.querySelector('.comment[data-comment-id="' + commentId + '"]');
      if (comment) {
        var replyForm = comment.querySelector('.reply-form');
        if (replyForm) {
          replyForm.style.display = 'block';
          var textarea = replyForm.querySelector('textarea');
          if (textarea) {
            textarea.focus();
          }
        }
      }
    }
    
    // 返信をキャンセル
    function cancelReply(button) {
      var replyForm = button.closest('.reply-form');
      if (replyForm) {
        replyForm.style.display = 'none';
        replyForm.querySelector('textarea').value = '';
      }
    }
    
    // DOMContentLoaded イベントリスナーの修正（最後に未送信コメントのチェック処理を追加）
    document.addEventListener('DOMContentLoaded', function() {
      console.log('コメントシステム初期化開始');
      
      // コメント送信ボタンのイベントリスナー
      var submitButton = document.getElementById('submitComment');
      if (submitButton) {
        submitButton.addEventListener('click', submitComment);
      }
      
      // 返信ボタンのイベントリスナー
      var replyButtons = document.querySelectorAll('.reply-button');
      replyButtons.forEach(function(button) {
        button.addEventListener('click', function() {
          var commentId = this.getAttribute('data-comment-id');
          showReplyForm(commentId);
        });
      });
      
      // 返信送信ボタンのイベントリスナー
      var submitReplyButtons = document.querySelectorAll('.submit-reply');
      submitReplyButtons.forEach(function(button) {
        button.addEventListener('click', function() {
          submitReply(this);
        });
      });
      
      // 返信キャンセルボタンのイベントリスナー
      var cancelReplyButtons = document.querySelectorAll('.cancel-reply');
      cancelReplyButtons.forEach(function(button) {
        button.addEventListener('click', function() {
          cancelReply(this);
        });
      });
      
      // フォーム送信イベントの処理
      var commentForm = document.getElementById('commentForm');
      if (commentForm) {
        commentForm.addEventListener('submit', function(e) {
          e.preventDefault();
          submitComment();
        });
      }
      
      // 未送信コメントの確認
      checkPendingComments();
      
      console.log('コメントシステム初期化完了');
    });
  </script>
</body>
</html>
